<!DOCTYPE html>
<html lang='zh' ><meta charset="utf-8">
<meta name="viewport" content="width=device-width">


<title>RPCè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆ1ï¼‰ | DamonZhangğŸ”¥</title>

<meta name="generator" content="Hugo Eureka 0.8.3" />
<link rel="stylesheet" href="https://damon-zhangb.github.io/css/eureka.min.css">
<script defer src="https://damon-zhangb.github.io/js/eureka.min.js"></script>

<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload"
  href="https://fonts.googleapis.com/css2?family=Lora:wght@400;600;700&family=Noto+Serif+SC:wght@400;600;700&display=swap"
  as="style" onload="this.onload=null;this.rel='stylesheet'">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.0/build/styles/idea.min.css"
   media="print"
  onload="this.media='all';this.onload=null" crossorigin>
<script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.0/build/highlight.min.js"
   crossorigin></script>

  <script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.0/build/languages/dart.min.js"
     crossorigin></script>

  <script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@10.1.0/build/languages/Go.min.js"
     crossorigin></script>

<script defer src="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.14.0/js/all.min.js"
   integrity="sha256-uNYoXefWRqv&#43;PsIF/OflNmwtKM4lStn9yrz2gVl6ymo="  crossorigin></script>




<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"
   integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3&#43;Aro6EYUG4&#43;cU&#43;KJWu/X"  media="print"
  onload="this.media='all';this.onload=null" crossorigin>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" 
  integrity="sha384-g7c&#43;Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI&#43;sEnkvrMWph2EDg4"  crossorigin></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"
   integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC&#43;Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa"  crossorigin></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    renderMathInElement(document.body, {
      delimiters: [
        { left: "$$", right: "$$", display: true },
        { left: "$", right: "$", display: false },
        { left: "\\(", right: "\\)", display: false },
        { left: "\\[", right: "\\]", display: true }
      ],
    });
  });
</script>


<script defer src="https://cdn.jsdelivr.net/npm/mermaid@8.9.2/dist/mermaid.min.js" 
  integrity="sha256-Zmpaaj&#43;GXFsPF5WdPArSrnW3b30dovldeKsW00xBVwE="  crossorigin></script>



<meta name="description"
  content="è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRemote Procedure Callï¼Œç¼©å†™ä¸º RPCï¼‰æ˜¯ä¸€ä¸ªè®¡ç®—æœºé€šä¿¡åè®®ã€‚è¯¥åè®®å…è®¸è¿è¡Œäºä¸€å°è®¡ç®—æœºçš„ç¨‹åºè°ƒç”¨å¦ä¸€å°è®¡ç®—æœºçš„å­ç¨‹åºï¼Œè€Œç¨‹åºå‘˜æ— éœ€é¢å¤–åœ°ä¸ºè¿™ä¸ªäº¤äº’ä½œç”¨ç¼–ç¨‹ã€‚">
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
      "@type": "ListItem",
      "position": 1 ,
      "name":"Posts",
      "item":"https://damon-zhangb.github.io/posts/"},{
      "@type": "ListItem",
      "position": 2 ,
      "name":"RPCè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆ1ï¼‰",
      "item":"https://damon-zhangb.github.io/posts/rpc%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B/"}]
}
</script>



<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://damon-zhangb.github.io/posts/rpc%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B/"
    },
    "headline": "RPCè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆ1ï¼‰ | DamonZhangğŸ”¥","datePublished": "2021-11-01T10:40:18+08:00",
    "dateModified": "2021-11-01T10:40:18+08:00",
    "wordCount":  565 ,
    "author": {
        "@type": "Person",
        "name": "Me"
    },
    "publisher": {
        "@type": "Person",
        "name": "Damon",
        },
    "description": "è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRemote Procedure Callï¼Œç¼©å†™ä¸º RPCï¼‰æ˜¯ä¸€ä¸ªè®¡ç®—æœºé€šä¿¡åè®®ã€‚è¯¥åè®®å…è®¸è¿è¡Œäºä¸€å°è®¡ç®—æœºçš„ç¨‹åºè°ƒç”¨å¦ä¸€å°è®¡ç®—æœºçš„å­ç¨‹åºï¼Œè€Œç¨‹åºå‘˜æ— éœ€é¢å¤–åœ°ä¸ºè¿™ä¸ªäº¤äº’ä½œç”¨ç¼–ç¨‹ã€‚"
}
</script><meta property="og:title" content="RPCè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆ1ï¼‰ | DamonZhangğŸ”¥" />
<meta property="og:type" content="article" />



<meta property="og:url" content="https://damon-zhangb.github.io/posts/rpc%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B/" />



<meta property="og:description" content="è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRemote Procedure Callï¼Œç¼©å†™ä¸º RPCï¼‰æ˜¯ä¸€ä¸ªè®¡ç®—æœºé€šä¿¡åè®®ã€‚è¯¥åè®®å…è®¸è¿è¡Œäºä¸€å°è®¡ç®—æœºçš„ç¨‹åºè°ƒç”¨å¦ä¸€å°è®¡ç®—æœºçš„å­ç¨‹åºï¼Œè€Œç¨‹åºå‘˜æ— éœ€é¢å¤–åœ°ä¸ºè¿™ä¸ªäº¤äº’ä½œç”¨ç¼–ç¨‹ã€‚" />



<meta property="og:locale" content="zh" />




<meta property="og:site_name" content="DamonZhangğŸ”¥" />






<meta property="article:published_time" content="2021-11-01T10:40:18&#43;08:00" />


<meta property="article:modified_time" content="2021-11-01T10:40:18&#43;08:00" />



<meta property="article:section" content="posts" />


<meta property="article:tag" content="åˆ†å¸ƒå¼æŠ€æœ¯" />





<body class="flex flex-col min-h-screen">
  <header class="fixed flex items-center w-full min-h-16 pl-scrollbar z-50 bg-secondary-bg shadow-sm">
    <div class="w-full max-w-screen-xl mx-auto"><script>
    let storageColorScheme = localStorage.getItem("lightDarkMode")
    if (((storageColorScheme == 'Auto' || storageColorScheme == null) && window.matchMedia("(prefers-color-scheme: dark)").matches) || storageColorScheme == "Dark") {
        document.getElementsByTagName('html')[0].classList.add('dark')
    }
</script>
<nav class="flex items-center justify-between flex-wrap px-4 py-4 md:py-0">
    <a href="/" class="mr-6 text-primary-text text-xl font-bold">DamonZhangğŸ”¥</a>
    <button id="navbar-btn" class="md:hidden flex items-center px-3 py-2" aria-label="Open Navbar">
        <i class="fas fa-bars"></i>
    </button>

    <div id="target"
        class="hidden block md:flex md:flex-grow md:justify-between md:items-center w-full md:w-auto text-primary-text z-20">
        <div class="md:flex md:h-16 text-sm md:flex-grow pb-4 md:pb-0 border-b md:border-b-0">
            <a href="/#about" class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2  border-transparent  mr-4">å…³äºæˆ‘</a>
            <a href="/posts/" class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2  selected-menu-item  mr-4">æ–‡ç« </a>
            <a href="/docs/" class="block mt-4 md:inline-block md:mt-0 md:h-(16-4px) md:leading-(16-4px) box-border md:border-t-2 md:border-b-2  border-transparent  mr-4">æ¡£æ¡ˆ</a>
        </div>

        <div class="flex">
            <div class="relative pt-4 md:pt-0">
                <div class="cursor-pointer hover:text-eureka" id="lightDarkMode">
                    <i class="fas fa-adjust"></i>
                </div>
                <div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-30" id="is-open">
                </div>
                <div class="absolute flex flex-col left-0 md:left-auto right-auto md:right-0 hidden bg-secondary-bg w-48 rounded py-2 border border-tertiary-bg cursor-pointer z-40"
                    id='lightDarkOptions'>
                    <span class="px-4 py-1 hover:text-eureka" name="Light">æµ…è‰²</span>
                    <span class="px-4 py-1 hover:text-eureka" name="Dark">æ·±è‰²</span>
                    <span class="px-4 py-1 hover:text-eureka" name="Auto">è‡ªåŠ¨</span>
                </div>
            </div>
        </div>
    </div>

    <div class="fixed hidden inset-0 opacity-0 h-full w-full cursor-default z-0" id="is-open-mobile">
    </div>

</nav>
<script>
    
    let element = document.getElementById('lightDarkMode')
    if (storageColorScheme == null || storageColorScheme == 'Auto') {
        document.addEventListener('DOMContentLoaded', () => {
            window.matchMedia("(prefers-color-scheme: dark)").addEventListener('change', switchDarkMode)
        })
    } else if (storageColorScheme == "Light") {
        element.firstElementChild.classList.remove('fa-adjust')
        element.firstElementChild.setAttribute("data-icon", 'sun')
        element.firstElementChild.classList.add('fa-sun')
    } else if (storageColorScheme == "Dark") {
        element.firstElementChild.classList.remove('fa-adjust')
        element.firstElementChild.setAttribute("data-icon", 'moon')
        element.firstElementChild.classList.add('fa-moon')
    }

    document.addEventListener('DOMContentLoaded', () => {
        getcolorscheme();
        switchBurger();
    });
</script>
</div>
  </header>
  <main class="flex-grow pt-16">
    <div class="pl-scrollbar">
      <div class="w-full max-w-screen-xl lg:px-4 xl:px-8 mx-auto">


<div class="grid grid-cols-2 lg:grid-cols-8 gap-4 lg:pt-12">
    <div
        class="col-span-2  lg:col-span-6 bg-secondary-bg rounded px-6 py-8">
        <h1 class="font-bold text-3xl text-primary-text">RPCè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆ1ï¼‰</h1>
        <div class="flex flex-wrap flex-row items-center mt-2 text-tertiary-text">
    <div class="mr-6 my-2">
        <i class="fas fa-calendar mr-1"></i>
        <span>2021-11-01</span>
    </div>
    <div class="mr-6 my-2">
        <i class="fas fa-clock mr-1"></i>
        <span>3åˆ†é’Ÿé˜…è¯»æ—¶é•¿</span>
    </div>
    
    
    <div class="mr-6 my-2">
        <i class="fas fa-folder mr-1"></i>
        
        <a href="https://damon-zhangb.github.io/categories/%E7%90%86%E8%AE%BA/" class="hover:text-eureka">ç†è®º</a>
        
    </div>
    

    
</div>
        
        
        

        <div class="content">
            <h1 id="rpcè¿œç¨‹è¿‡ç¨‹è°ƒç”¨1">RPCè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆ1ï¼‰</h1>
<h2 id="ç®€ä»‹">ç®€ä»‹</h2>
<p><em><strong>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨</strong></em>ï¼ˆRemote Procedure Callï¼Œç¼©å†™ä¸º <strong>RPC</strong>ï¼‰æ˜¯ä¸€ä¸ªè®¡ç®—æœºé€šä¿¡åè®®ã€‚è¯¥åè®®å…è®¸è¿è¡Œäºä¸€å°è®¡ç®—æœºçš„ç¨‹åºè°ƒç”¨å¦ä¸€å°è®¡ç®—æœºçš„å­ç¨‹åºï¼Œè€Œç¨‹åºå‘˜æ— éœ€é¢å¤–åœ°ä¸ºè¿™ä¸ªäº¤äº’ä½œç”¨ç¼–ç¨‹ã€‚</p>
<p>é€šä¿—åœ°è¯´å°±æ˜¯<strong><em>RPC</em>è°ƒç”¨è¿œå¤„çš„ä¸€ä¸ªå‡½æ•°</strong>ã€‚è¿œå¤„åˆ°åº•æœ‰å¤šè¿œå‘¢ï¼Ÿå¯èƒ½æ˜¯åŒä¸€ä¸ªæ–‡ä»¶å†…çš„ä¸åŒå‡½æ•°ï¼Œä¹Ÿå¯èƒ½æ˜¯åŒä¸€ä¸ªæœºå™¨çš„å¦ä¸€ä¸ªè¿›ç¨‹çš„å‡½æ•°ï¼Œè¿˜å¯èƒ½æ˜¯è¿œåœ¨ç«æ˜Ÿå¥½å¥‡å·ä¸Šé¢çš„æŸä¸ªç§˜å¯†æ–¹æ³•ã€‚</p>
<p>æœ¬ç« å°†è®¨è®ºRPCçš„åŸºæœ¬ç”¨æ³•ï¼Œå¦‚ä½•é’ˆå¯¹ä¸åŒåœºæ™¯è®¾è®¡è‡ªå·±çš„RPCæœåŠ¡ã€‚</p>
<h2 id="ç†è®º">ç†è®º</h2>
<p>åœ¨ä¸€ä¸ªå…¸å‹ RPC çš„ä½¿ç”¨åœºæ™¯ä¸­ï¼ŒåŒ…å«äº†<strong>æœåŠ¡å‘ç°</strong>ã€<strong>è´Ÿè½½</strong>ã€<strong>å®¹é”™</strong>ã€<strong>ç½‘ç»œä¼ è¾“</strong>ã€<strong>åºåˆ—åŒ–</strong>ç­‰ç»„ä»¶ï¼Œå…¶ä¸­â€œ<strong>RPC åè®®</strong>â€å°±æŒ‡æ˜äº†ç¨‹åºå¦‚ä½•è¿›è¡Œç½‘ç»œä¼ è¾“å’Œåºåˆ—åŒ–ã€‚</p>
<p><img src="/RPC/1.jpg" alt="&ldquo;æ¡†æ¶&rdquo;"></p>
<center>å›¾1-æ¡†æ¶å›¾</center>
<p>ä¸€ä¸ª RPC çš„æ ¸å¿ƒåŠŸèƒ½ä¸»è¦æœ‰ 5 ä¸ªéƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼šå®¢æˆ·ç«¯ã€å®¢æˆ·ç«¯ Stubã€ç½‘ç»œä¼ è¾“æ¨¡å—ã€æœåŠ¡ç«¯ Stubã€æœåŠ¡ç«¯ç­‰ã€‚</p>
<p><img src="/RPC/2.jpg" alt="&ldquo;æ ¸å¿ƒåŠŸèƒ½&rdquo;"></p>
<center>å›¾2-æ ¸å¿ƒåŠŸèƒ½</center>
<p><img src="/RPC/3.jpg" alt=""></p>
<h5 id="ä¸‹é¢åˆ†åˆ«ä»‹ç»æ ¸å¿ƒ-rpc-æ¡†æ¶çš„é‡è¦ç»„æˆ">ä¸‹é¢åˆ†åˆ«ä»‹ç»æ ¸å¿ƒ RPC æ¡†æ¶çš„<strong>é‡è¦ç»„æˆ</strong>ï¼š</h5>
<ul>
<li><strong>å®¢æˆ·ç«¯</strong>(Client)ï¼šæœåŠ¡è°ƒç”¨æ–¹ã€‚</li>
<li><strong>å®¢æˆ·ç«¯å­˜æ ¹</strong>(Client Stub)ï¼šå­˜æ”¾æœåŠ¡ç«¯åœ°å€ä¿¡æ¯ï¼Œå°†å®¢æˆ·ç«¯çš„è¯·æ±‚å‚æ•°æ•°æ®ä¿¡æ¯æ‰“åŒ…æˆç½‘ç»œæ¶ˆæ¯ï¼Œå†é€šè¿‡ç½‘ç»œä¼ è¾“å‘é€ç»™æœåŠ¡ç«¯ã€‚</li>
<li><strong>æœåŠ¡ç«¯å­˜æ ¹</strong>(Server Stub)ï¼šæ¥æ”¶å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„è¯·æ±‚æ¶ˆæ¯å¹¶è¿›è¡Œè§£åŒ…ï¼Œç„¶åå†è°ƒç”¨æœ¬åœ°æœåŠ¡è¿›è¡Œå¤„ç†ã€‚</li>
<li>**æœåŠ¡ç«¯(**Server)ï¼šæœåŠ¡çš„çœŸæ­£æä¾›è€…ã€‚</li>
<li><strong>Network Service</strong>ï¼šåº•å±‚ä¼ è¾“ï¼Œå¯ä»¥æ˜¯ TCP æˆ– HTTPã€‚</li>
</ul>
<h5 id="æœåŠ¡çš„è°ƒç”¨è¿‡ç¨‹ä¸º">æœåŠ¡çš„<strong>è°ƒç”¨è¿‡ç¨‹</strong>ä¸ºï¼š</h5>
<ol>
<li><strong>client</strong>è°ƒç”¨<strong>client stub</strong>ï¼Œè¿™æ˜¯ä¸€æ¬¡æœ¬åœ°è¿‡ç¨‹è°ƒç”¨</li>
<li>client stubå°†å‚æ•°æ‰“åŒ…æˆä¸€ä¸ªæ¶ˆæ¯ï¼Œç„¶åå‘é€è¿™ä¸ªæ¶ˆæ¯ã€‚æ‰“åŒ…è¿‡ç¨‹ä¹Ÿå«åš <strong>marshalling</strong></li>
<li><strong>client</strong>æ‰€åœ¨çš„ç³»ç»Ÿå°†æ¶ˆæ¯å‘é€ç»™<strong>server</strong></li>
<li><strong>server</strong>çš„çš„ç³»ç»Ÿå°†æ”¶åˆ°çš„åŒ…ä¼ ç»™<strong>server stub</strong></li>
<li><strong>server stub</strong>è§£åŒ…å¾—åˆ°å‚æ•°ã€‚ è§£åŒ…ä¹Ÿè¢«ç§°ä½œ <strong>unmarshalling</strong></li>
<li>æœ€å<strong>server stub</strong>è°ƒç”¨æœåŠ¡è¿‡ç¨‹. è¿”å›ç»“æœæŒ‰ç…§ç›¸åçš„æ­¥éª¤ä¼ ç»™<strong>client</strong></li>
</ol>
<h5 id="æ€»ç»“ä¸€ä¸‹rpcè¦è§£å†³çš„ä¸¤ä¸ªé—®é¢˜">æ€»ç»“ä¸€ä¸‹ï¼Œ<strong>RPCè¦è§£å†³çš„ä¸¤ä¸ªé—®é¢˜ï¼š</strong></h5>
<ol>
<li><strong>è§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡ä¹‹é—´çš„è°ƒç”¨é—®é¢˜ã€‚</strong></li>
<li><strong>è¿œç¨‹è°ƒç”¨æ—¶ï¼Œè¦èƒ½å¤Ÿåƒæœ¬åœ°è°ƒç”¨ä¸€æ ·æ–¹ä¾¿ï¼Œè®©è°ƒç”¨è€…æ„ŸçŸ¥ä¸åˆ°è¿œç¨‹è°ƒç”¨çš„é€»è¾‘ã€‚</strong></li>
</ol>
<h2 id="hello-world">Hello World</h2>
<p>Goè¯­è¨€çš„RPCåŒ…çš„è·¯å¾„ä¸ºnet/rpcï¼Œä¹Ÿå°±æ˜¯æ”¾åœ¨äº†netåŒ…ç›®å½•ä¸‹é¢ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥çŒœæµ‹è¯¥RPCåŒ…æ˜¯å»ºç«‹åœ¨netåŒ…åŸºç¡€ä¹‹ä¸Šçš„ã€‚</p>
<p><em>æˆ‘ä»¬å…ˆæ„é€ ä¸€ä¸ªHelloServiceç±»å‹ï¼Œå…¶ä¸­çš„Helloæ–¹æ³•ç”¨äºå®ç°æ‰“å°åŠŸèƒ½ï¼š</em></p>
<pre><code class="language-go">type HelloService struct {}

func (p *HelloService) Hello(request string, reply *string) error {
    *reply = &quot;hello:&quot; + request
    return nil
}
</code></pre>
<p>å…¶ä¸­Helloæ–¹æ³•å¿…é¡»æ»¡è¶³Goè¯­è¨€çš„RPCè§„åˆ™ï¼š<strong>æ–¹æ³•åªèƒ½æœ‰ä¸¤ä¸ªå¯åºåˆ—åŒ–çš„å‚æ•°ï¼Œå…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°æ˜¯æŒ‡é’ˆç±»å‹ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªerrorç±»å‹ï¼ŒåŒæ—¶å¿…é¡»æ˜¯å…¬å¼€çš„æ–¹æ³•ã€‚</strong></p>
<p><em>ç„¶åå°±å¯ä»¥å°†HelloServiceç±»å‹çš„å¯¹è±¡æ³¨å†Œä¸ºä¸€ä¸ªRPCæœåŠ¡ï¼š</em></p>
<pre><code class="language-go">func main() {
    rpc.RegisterName(&quot;HelloService&quot;, new(HelloService))

    listener, err := net.Listen(&quot;tcp&quot;, &quot;:1234&quot;)
    if err != nil {
        log.Fatal(&quot;ListenTCP error:&quot;, err)
    }

    conn, err := listener.Accept()
    if err != nil {
        log.Fatal(&quot;Accept error:&quot;, err)
    }

    rpc.ServeConn(conn)
}
</code></pre>
<p>å…¶ä¸­<strong>rpc.Register</strong>å‡½æ•°è°ƒç”¨ä¼šå°†å¯¹è±¡ç±»å‹ä¸­æ‰€æœ‰æ»¡è¶³RPCè§„åˆ™çš„å¯¹è±¡æ–¹æ³•æ³¨å†Œä¸ºRPCå‡½æ•°ï¼Œæ‰€æœ‰æ³¨å†Œçš„æ–¹æ³•ä¼šæ”¾åœ¨â€œ<strong>HelloService</strong>â€æœåŠ¡ç©ºé—´ä¹‹ä¸‹ã€‚ç„¶åæˆ‘ä»¬å»ºç«‹ä¸€ä¸ªå”¯ä¸€çš„TCPé“¾æ¥ï¼Œå¹¶ä¸”é€šè¿‡<strong>rpc.ServeConn</strong>å‡½æ•°åœ¨è¯¥TCPé“¾æ¥ä¸Šä¸ºå¯¹æ–¹æä¾›RPCæœåŠ¡ã€‚</p>
<p><em>ä¸‹é¢æ˜¯å®¢æˆ·ç«¯è¯·æ±‚HelloServiceæœåŠ¡çš„ä»£ç ï¼š</em></p>
<pre><code class="language-go">func main() {
    client, err := rpc.Dial(&quot;tcp&quot;, &quot;localhost:1234&quot;)
    if err != nil {
        log.Fatal(&quot;dialing:&quot;, err)
    }

    var reply string
    err = client.Call(&quot;HelloService.Hello&quot;, &quot;hello&quot;, &amp;reply)
    if err != nil {
        log.Fatal(err)
    }

    fmt.Println(reply)
}
</code></pre>
<p>é¦–å…ˆæ˜¯é€šè¿‡<strong>rpc.Dial</strong>æ‹¨å·RPCæœåŠ¡ï¼Œç„¶åé€šè¿‡<strong>client.Call</strong>è°ƒç”¨å…·ä½“çš„RPCæ–¹æ³•ã€‚åœ¨è°ƒç”¨<strong>client.Call</strong>æ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<strong>ç”¨ç‚¹å·é“¾æ¥çš„RPCæœåŠ¡åå­—å’Œæ–¹æ³•åå­—</strong>ï¼Œç¬¬äºŒå’Œç¬¬ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æˆ‘ä»¬<strong>å®šä¹‰RPCæ–¹æ³•çš„ä¸¤ä¸ªå‚æ•°</strong>ã€‚</p>
<p>ç”±è¿™ä¸ªä¾‹å­å¯ä»¥çœ‹å‡ºRPCçš„ä½¿ç”¨å…¶å®éå¸¸ç®€å•ã€‚</p>
<h2 id="æ›´å®‰å…¨çš„rpcæ¥å£">æ›´å®‰å…¨çš„RPCæ¥å£</h2>
<p>åœ¨æ¶‰åŠRPCçš„åº”ç”¨ä¸­ï¼Œä½œä¸ºå¼€å‘äººå‘˜ä¸€èˆ¬è‡³å°‘æœ‰ä¸‰ç§è§’è‰²ï¼šé¦–å…ˆæ˜¯<strong>æœåŠ¡ç«¯å®ç°RPCæ–¹æ³•çš„å¼€å‘äººå‘˜</strong>ï¼Œå…¶æ¬¡æ˜¯<strong>å®¢æˆ·ç«¯è°ƒç”¨RPCæ–¹æ³•çš„äººå‘˜</strong>ï¼Œæœ€åä¹Ÿæ˜¯æœ€é‡è¦çš„æ˜¯<strong>åˆ¶å®šæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯RPCæ¥å£è§„èŒƒçš„è®¾è®¡äººå‘˜</strong>ã€‚åœ¨å‰é¢çš„ä¾‹å­ä¸­æˆ‘ä»¬ä¸ºäº†ç®€åŒ–å°†ä»¥ä¸Šå‡ ç§è§’è‰²çš„å·¥ä½œå…¨éƒ¨æ”¾åˆ°äº†ä¸€èµ·ï¼Œè™½ç„¶çœ‹ä¼¼å®ç°ç®€å•ï¼Œä½†æ˜¯ä¸åˆ©äºåæœŸçš„ç»´æŠ¤å’Œå·¥ä½œçš„åˆ‡å‰²ã€‚</p>
<p><em>å¦‚æœè¦é‡æ„HelloServiceæœåŠ¡ï¼Œç¬¬ä¸€æ­¥éœ€è¦æ˜ç¡®æœåŠ¡çš„åå­—å’Œæ¥å£ï¼š</em></p>
<pre><code class="language-go">const HelloServiceName = &quot;path/to/pkg.HelloService&quot;

type HelloServiceInterface = interface {
    Hello(request string, reply *string) error
}

func RegisterHelloService(svc HelloServiceInterface) error {
    return rpc.RegisterName(HelloServiceName, svc)
}
</code></pre>
<p>æˆ‘ä»¬å°†RPCæœåŠ¡çš„æ¥å£è§„èŒƒåˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼šé¦–å…ˆæ˜¯<strong>æœåŠ¡çš„åå­—</strong>ï¼Œç„¶åæ˜¯<strong>æœåŠ¡è¦å®ç°çš„è¯¦ç»†æ–¹æ³•åˆ—è¡¨</strong>ï¼Œæœ€åæ˜¯<strong>æ³¨å†Œè¯¥ç±»å‹æœåŠ¡çš„å‡½æ•°</strong>ã€‚ä¸ºäº†é¿å…åå­—å†²çªï¼Œæˆ‘ä»¬åœ¨RPCæœåŠ¡çš„åå­—ä¸­å¢åŠ äº†åŒ…è·¯å¾„å‰ç¼€ï¼ˆè¿™ä¸ªæ˜¯RPCæœåŠ¡æŠ½è±¡çš„åŒ…è·¯å¾„ï¼Œå¹¶éå®Œå…¨ç­‰ä»·Goè¯­è¨€çš„åŒ…è·¯å¾„ï¼‰ã€‚<strong>RegisterHelloService</strong>æ³¨å†ŒæœåŠ¡æ—¶ï¼Œç¼–è¯‘å™¨ä¼šè¦æ±‚ä¼ å…¥çš„å¯¹è±¡æ»¡è¶³<strong>HelloServiceInterface</strong>æ¥å£ã€‚</p>
<p><em>åœ¨å®šä¹‰äº†RPCæœåŠ¡æ¥å£è§„èŒƒä¹‹åï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥æ ¹æ®è§„èŒƒç¼–å†™RPCè°ƒç”¨çš„ä»£ç äº†</em></p>
<pre><code class="language-go">func main() {
    client, err := rpc.Dial(&quot;tcp&quot;, &quot;localhost:1234&quot;)
    if err != nil {
        log.Fatal(&quot;dialing:&quot;, err)
    }

    var reply string
    err = client.Call(HelloServiceName+&quot;.Hello&quot;, &quot;hello&quot;, &amp;reply)
    if err != nil {
        log.Fatal(err)
    }
}
</code></pre>
<p>å…¶ä¸­å”¯ä¸€çš„å˜åŒ–æ˜¯<strong>client.Call</strong>çš„ç¬¬ä¸€ä¸ªå‚æ•°ç”¨HelloServiceName+&quot;.Hello&quot;ä»£æ›¿äº†**&ldquo;HelloService.Hello&rdquo;**ã€‚ç„¶è€Œé€šè¿‡**client.Call**å‡½æ•°è°ƒç”¨RPCæ–¹æ³•ä¾ç„¶æ¯”è¾ƒç¹çï¼ŒåŒæ—¶å‚æ•°çš„ç±»å‹ä¾ç„¶æ— æ³•å¾—åˆ°ç¼–è¯‘å™¨æä¾›çš„å®‰å…¨ä¿éšœã€‚</p>
<p><em>ä¸ºäº†ç®€åŒ–å®¢æˆ·ç«¯ç”¨æˆ·è°ƒç”¨RPCå‡½æ•°ï¼Œæˆ‘ä»¬åœ¨å¯ä»¥åœ¨æ¥å£è§„èŒƒéƒ¨åˆ†å¢åŠ å¯¹å®¢æˆ·ç«¯çš„ç®€å•åŒ…è£…ï¼š</em></p>
<pre><code class="language-go">type HelloServiceClient struct {
    *rpc.Client
}

var _ HelloServiceInterface = (*HelloServiceClient)(nil)

func DialHelloService(network, address string) (*HelloServiceClient, error) {
    c, err := rpc.Dial(network, address)
    if err != nil {
        return nil, err
    }
    return &amp;HelloServiceClient{Client: c}, nil
}

func (p *HelloServiceClient) Hello(request string, reply *string) error {
    return p.Client.Call(HelloServiceName+&quot;.Hello&quot;, request, reply)
}
</code></pre>
<p>æˆ‘ä»¬åœ¨æ¥å£è§„èŒƒä¸­é’ˆå¯¹å®¢æˆ·ç«¯æ–°å¢åŠ äº†<strong>HelloServiceClient</strong>ç±»å‹ï¼Œè¯¥ç±»å‹ä¹Ÿå¿…é¡»æ»¡è¶³<strong>HelloServiceInterface</strong>æ¥å£ï¼Œè¿™æ ·å®¢æˆ·ç«¯ç”¨æˆ·å°±å¯ä»¥ç›´æ¥é€šè¿‡æ¥å£å¯¹åº”çš„æ–¹æ³•è°ƒç”¨RPCå‡½æ•°ã€‚åŒæ—¶æä¾›äº†ä¸€ä¸ª<strong>DialHelloService</strong>æ–¹æ³•ï¼Œç›´æ¥æ‹¨å·<strong>HelloService</strong>æœåŠ¡ã€‚</p>
<p><em>åŸºäºæ–°çš„å®¢æˆ·ç«¯æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥ç®€åŒ–å®¢æˆ·ç«¯ç”¨æˆ·çš„ä»£ç ï¼š</em></p>
<pre><code class="language-go">func main() {
    client, err := DialHelloService(&quot;tcp&quot;, &quot;localhost:1234&quot;)
    if err != nil {
        log.Fatal(&quot;dialing:&quot;, err)
    }

    var reply string
    err = client.Hello(&quot;hello&quot;, &amp;reply)
    if err != nil {
        log.Fatal(err)
    }
}
</code></pre>
<p>ç°åœ¨å®¢æˆ·ç«¯ç”¨æˆ·ä¸ç”¨å†æ‹…å¿ƒRPCæ–¹æ³•åå­—æˆ–å‚æ•°ç±»å‹ä¸åŒ¹é…ç­‰ä½çº§é”™è¯¯çš„å‘ç”Ÿã€‚</p>
<p><em>æœ€åæ˜¯åŸºäºRPCæ¥å£è§„èŒƒç¼–å†™çœŸå®çš„æœåŠ¡ç«¯ä»£ç ï¼š</em></p>
<pre><code class="language-go">type HelloService struct {}

func (p *HelloService) Hello(request string, reply *string) error {
    *reply = &quot;hello:&quot; + request
    return nil
}

func main() {
    RegisterHelloService(new(HelloService))

    listener, err := net.Listen(&quot;tcp&quot;, &quot;:1234&quot;)
    if err != nil {
        log.Fatal(&quot;ListenTCP error:&quot;, err)
    }

    for {
        conn, err := listener.Accept()
        if err != nil {
            log.Fatal(&quot;Accept error:&quot;, err)
        }

        go rpc.ServeConn(conn)
    }
}
</code></pre>
<p>åœ¨æ–°çš„RPCæœåŠ¡ç«¯å®ç°ä¸­ï¼Œæˆ‘ä»¬ç”¨<strong>RegisterHelloService</strong>å‡½æ•°æ¥æ³¨å†Œå‡½æ•°ï¼Œè¿™æ ·ä¸ä»…å¯ä»¥é¿å…å‘½åæœåŠ¡åç§°çš„å·¥ä½œï¼ŒåŒæ—¶ä¹Ÿä¿è¯äº†ä¼ å…¥çš„æœåŠ¡å¯¹è±¡æ»¡è¶³äº†RPCæ¥å£çš„å®šä¹‰ã€‚æœ€åæˆ‘ä»¬æ–°çš„æœåŠ¡æ”¹ä¸ºæ”¯æŒå¤šä¸ªTCPé“¾æ¥ï¼Œç„¶åä¸ºæ¯ä¸ªTCPé“¾æ¥æä¾›RPCæœåŠ¡ã€‚</p>
<h2 id="è·¨è¯­è¨€çš„rpc">è·¨è¯­è¨€çš„RPC</h2>
<p>æ ‡å‡†åº“çš„RPCé»˜è®¤é‡‡ç”¨Goè¯­è¨€ç‰¹æœ‰çš„gobç¼–ç ï¼Œå› æ­¤ä»å…¶å®ƒè¯­è¨€è°ƒç”¨Goè¯­è¨€å®ç°çš„RPCæœåŠ¡å°†æ¯”è¾ƒå›°éš¾ã€‚åœ¨äº’è”ç½‘çš„å¾®æœåŠ¡æ—¶ä»£ï¼Œæ¯ä¸ªRPCä»¥åŠæœåŠ¡çš„ä½¿ç”¨è€…éƒ½å¯èƒ½é‡‡ç”¨ä¸åŒçš„ç¼–ç¨‹è¯­è¨€ï¼Œå› æ­¤è·¨è¯­è¨€æ˜¯äº’è”ç½‘æ—¶ä»£RPCçš„ä¸€ä¸ªé¦–è¦æ¡ä»¶ã€‚å¾—ç›ŠäºRPCçš„æ¡†æ¶è®¾è®¡ï¼ŒGoè¯­è¨€çš„RPCå…¶å®ä¹Ÿæ˜¯å¾ˆå®¹æ˜“å®ç°è·¨è¯­è¨€æ”¯æŒçš„ã€‚</p>
<p>Goè¯­è¨€çš„RPCæ¡†æ¶æœ‰ä¸¤ä¸ªæ¯”è¾ƒæœ‰ç‰¹è‰²çš„è®¾è®¡ï¼šä¸€ä¸ªæ˜¯<strong>RPCæ•°æ®æ‰“åŒ…æ—¶å¯ä»¥é€šè¿‡æ’ä»¶å®ç°è‡ªå®šä¹‰çš„ç¼–ç å’Œè§£ç </strong>ï¼›å¦ä¸€ä¸ªæ˜¯<strong>RPCå»ºç«‹åœ¨æŠ½è±¡çš„io.ReadWriteCloseræ¥å£ä¹‹ä¸Šçš„</strong>ï¼Œæˆ‘ä»¬å¯ä»¥å°†RPCæ¶è®¾åœ¨ä¸åŒçš„é€šè®¯åè®®ä¹‹ä¸Šã€‚è¿™é‡Œæˆ‘ä»¬å°†å°è¯•é€šè¿‡å®˜æ–¹è‡ªå¸¦çš„net/rpc/jsonrpcæ‰©å±•å®ç°ä¸€ä¸ªè·¨è¯­è¨€çš„RPCã€‚</p>
<p><em>é¦–å…ˆæ˜¯åŸºäºjsonç¼–ç é‡æ–°å®ç°RPCæœåŠ¡ï¼š</em></p>
<pre><code class="language-go">func main() {
    rpc.RegisterName(&quot;HelloService&quot;, new(HelloService))

    listener, err := net.Listen(&quot;tcp&quot;, &quot;:1234&quot;)
    if err != nil {
        log.Fatal(&quot;ListenTCP error:&quot;, err)
    }

    for {
        conn, err := listener.Accept()
        if err != nil {
            log.Fatal(&quot;Accept error:&quot;, err)
        }

        go rpc.ServeCodec(jsonrpc.NewServerCodec(conn))
    }
}
</code></pre>
<p>ä»£ç ä¸­æœ€å¤§çš„å˜åŒ–æ˜¯ç”¨<strong>rpc.ServeCodec</strong>å‡½æ•°æ›¿ä»£äº†<strong>rpc.ServeConn</strong>å‡½æ•°ï¼Œä¼ å…¥çš„å‚æ•°æ˜¯é’ˆå¯¹æœåŠ¡ç«¯çš„jsonç¼–è§£ç å™¨ã€‚</p>
<p><em>ç„¶åæ˜¯å®ç°jsonç‰ˆæœ¬çš„å®¢æˆ·ç«¯ï¼š</em></p>
<pre><code class="language-go">func main() {
    conn, err := net.Dial(&quot;tcp&quot;, &quot;localhost:1234&quot;)
    if err != nil {
        log.Fatal(&quot;net.Dial:&quot;, err)
    }

    client := rpc.NewClientWithCodec(jsonrpc.NewClientCodec(conn))

    var reply string
    err = client.Call(&quot;HelloService.Hello&quot;, &quot;hello&quot;, &amp;reply)
    if err != nil {
        log.Fatal(err)
    }

    fmt.Println(reply)
}
</code></pre>
<p>å…ˆæ‰‹å·¥è°ƒç”¨<strong>net.Dial</strong>å‡½æ•°å»ºç«‹TCPé“¾æ¥ï¼Œç„¶ååŸºäºè¯¥é“¾æ¥å»ºç«‹é’ˆå¯¹å®¢æˆ·ç«¯çš„jsonç¼–è§£ç å™¨ã€‚</p>
<p>åœ¨ç¡®ä¿å®¢æˆ·ç«¯å¯ä»¥æ­£å¸¸è°ƒç”¨RPCæœåŠ¡çš„æ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªæ™®é€šçš„TCPæœåŠ¡ä»£æ›¿Goè¯­è¨€ç‰ˆæœ¬çš„RPCæœåŠ¡ï¼Œè¿™æ ·å¯ä»¥æŸ¥çœ‹å®¢æˆ·ç«¯è°ƒç”¨æ—¶å‘é€çš„æ•°æ®æ ¼å¼ã€‚æ¯”å¦‚é€šè¿‡ncå‘½ä»¤<code>nc -l 1234</code>åœ¨åŒæ ·çš„ç«¯å£å¯åŠ¨ä¸€ä¸ªTCPæœåŠ¡ã€‚ç„¶åå†æ¬¡æ‰§è¡Œä¸€æ¬¡RPCè°ƒç”¨å°†ä¼šå‘ç°ncè¾“å‡ºäº†ä»¥ä¸‹çš„ä¿¡æ¯ï¼š</p>
<pre><code class="language-json">{&quot;method&quot;:&quot;HelloService.Hello&quot;,&quot;params&quot;:[&quot;hello&quot;],&quot;id&quot;:0}
</code></pre>
<p>è¿™æ˜¯ä¸€ä¸ªjsonç¼–ç çš„æ•°æ®ï¼Œå…¶ä¸­<strong>method</strong>éƒ¨åˆ†å¯¹åº”è¦è°ƒç”¨çš„rpcæœåŠ¡å’Œæ–¹æ³•ç»„åˆæˆçš„åå­—ï¼Œ<strong>params</strong>éƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºå‚æ•°ï¼Œ<strong>id</strong>æ˜¯ç”±è°ƒç”¨ç«¯ç»´æŠ¤çš„ä¸€ä¸ªå”¯ä¸€çš„è°ƒç”¨ç¼–å·ã€‚</p>
<p>è¯·æ±‚çš„jsonæ•°æ®å¯¹è±¡åœ¨å†…éƒ¨å¯¹åº”ä¸¤ä¸ªç»“æ„ä½“ï¼š</p>
<p>å®¢æˆ·ç«¯æ˜¯<strong>clientRequest</strong>ï¼ŒæœåŠ¡ç«¯æ˜¯<strong>serverRequest</strong>ã€‚<strong>clientRequest</strong>å’Œ<strong>serverRequest</strong>ç»“æ„ä½“çš„å†…å®¹åŸºæœ¬æ˜¯ä¸€è‡´çš„ï¼š</p>
<pre><code class="language-go">type clientRequest struct {
    Method string         `json:&quot;method&quot;`
    Params [1]interface{} `json:&quot;params&quot;`
    Id     uint64         `json:&quot;id&quot;`
}

type serverRequest struct {
    Method string           `json:&quot;method&quot;`
    Params *json.RawMessage `json:&quot;params&quot;`
    Id     *json.RawMessage `json:&quot;id&quot;`
}
</code></pre>
<p>åœ¨è·å–åˆ°RPCè°ƒç”¨å¯¹åº”çš„jsonæ•°æ®åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›´æ¥å‘æ¶è®¾äº†RPCæœåŠ¡çš„TCPæœåŠ¡å™¨å‘é€jsonæ•°æ®æ¨¡æ‹ŸRPCæ–¹æ³•è°ƒç”¨ï¼š</p>
<pre><code class="language-shell">$ echo -e '{&quot;method&quot;:&quot;HelloService.Hello&quot;,&quot;params&quot;:[&quot;hello&quot;],&quot;id&quot;:1}' | nc localhost 1234
</code></pre>
<p>è¿”å›çš„ç»“æœä¹Ÿæ˜¯ä¸€ä¸ªjsonæ ¼å¼çš„æ•°æ®ï¼š</p>
<pre><code class="language-json">{&quot;id&quot;:1,&quot;result&quot;:&quot;hello:hello&quot;,&quot;error&quot;:null}
</code></pre>
<p>å…¶ä¸­<strong>id</strong>å¯¹åº”è¾“å…¥çš„<strong>id</strong>å‚æ•°ï¼Œ<strong>result</strong>ä¸ºè¿”å›çš„ç»“æœï¼Œ<strong>error</strong>éƒ¨åˆ†åœ¨å‡ºé—®é¢˜æ—¶è¡¨ç¤ºé”™è¯¯ä¿¡æ¯ã€‚å¯¹äºé¡ºåºè°ƒç”¨æ¥è¯´ï¼Œidä¸æ˜¯å¿…é¡»çš„ã€‚ä½†æ˜¯Goè¯­è¨€çš„RPCæ¡†æ¶æ”¯æŒå¼‚æ­¥è°ƒç”¨ï¼Œå½“è¿”å›ç»“æœçš„é¡ºåºå’Œè°ƒç”¨çš„é¡ºåºä¸ä¸€è‡´æ—¶ï¼Œå¯ä»¥é€šè¿‡idæ¥è¯†åˆ«å¯¹åº”çš„è°ƒç”¨ã€‚</p>
<p>è¿”å›çš„jsonæ•°æ®ä¹Ÿæ˜¯å¯¹åº”å†…éƒ¨çš„ä¸¤ä¸ªç»“æ„ä½“ï¼šå®¢æˆ·ç«¯æ˜¯clientResponseï¼ŒæœåŠ¡ç«¯æ˜¯serverResponseã€‚ä¸¤ä¸ªç»“æ„ä½“çš„å†…å®¹åŒæ ·ä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼š</p>
<pre><code class="language-go">type clientResponse struct {
    Id     uint64           `json:&quot;id&quot;`
    Result *json.RawMessage `json:&quot;result&quot;`
    Error  interface{}      `json:&quot;error&quot;`
}

type serverResponse struct {
    Id     *json.RawMessage `json:&quot;id&quot;`
    Result interface{}      `json:&quot;result&quot;`
    Error  interface{}      `json:&quot;error&quot;`
}
</code></pre>
<p>å› æ­¤æ— è®ºé‡‡ç”¨ä½•ç§è¯­è¨€ï¼Œåªè¦éµå¾ªåŒæ ·çš„jsonç»“æ„ï¼Œä»¥åŒæ ·çš„æµç¨‹å°±å¯ä»¥å’ŒGoè¯­è¨€ç¼–å†™çš„RPCæœåŠ¡è¿›è¡Œé€šä¿¡ã€‚è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†è·¨è¯­è¨€çš„RPCã€‚</p>
<h2 id="httpä¸Šçš„rpc">Httpä¸Šçš„rpc</h2>
<p>Goè¯­è¨€å†…åœ¨çš„RPCæ¡†æ¶å·²ç»æ”¯æŒåœ¨Httpåè®®ä¸Šæä¾›RPCæœåŠ¡ã€‚ä½†æ˜¯æ¡†æ¶çš„httpæœåŠ¡åŒæ ·é‡‡ç”¨äº†å†…ç½®çš„gobåè®®ï¼Œå¹¶ä¸”æ²¡æœ‰æä¾›é‡‡ç”¨å…¶å®ƒåè®®çš„æ¥å£ï¼Œå› æ­¤ä»å…¶å®ƒè¯­è¨€ä¾ç„¶æ— æ³•è®¿é—®çš„ã€‚åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†åœ¨TCPåè®®ä¹‹ä¸Šè¿è¡ŒjsonrpcæœåŠ¡ï¼Œå¹¶ä¸”é€šè¿‡ncå‘½ä»¤è¡Œå·¥å…·æˆåŠŸå®ç°äº†RPCæ–¹æ³•è°ƒç”¨ã€‚ç°åœ¨æˆ‘ä»¬å°è¯•åœ¨httpåè®®ä¸Šæä¾›jsonrpcæœåŠ¡ã€‚</p>
<p><em>æ–°çš„RPCæœåŠ¡å…¶å®æ˜¯ä¸€ä¸ªç±»ä¼¼RESTè§„èŒƒçš„æ¥å£ï¼Œæ¥æ”¶è¯·æ±‚å¹¶é‡‡ç”¨ç›¸åº”å¤„ç†æµç¨‹ï¼š</em></p>
<pre><code class="language-go">func main() {
    rpc.RegisterName(&quot;HelloService&quot;, new(HelloService))

    http.HandleFunc(&quot;/jsonrpc&quot;, func(w http.ResponseWriter, r *http.Request) {
        var conn io.ReadWriteCloser = struct {
            io.Writer
            io.ReadCloser
        }{
            ReadCloser: r.Body,
            Writer:     w,
        }

        rpc.ServeRequest(jsonrpc.NewServerCodec(conn))
    })

    http.ListenAndServe(&quot;:1234&quot;, nil)
}
</code></pre>
<p>RPCçš„æœåŠ¡æ¶è®¾åœ¨â€œ/jsonrpcâ€è·¯å¾„ï¼Œåœ¨å¤„ç†å‡½æ•°ä¸­åŸºäº<strong>http.ResponseWriter</strong>å’Œ<strong>http.Request</strong>ç±»å‹çš„å‚æ•°æ„é€ ä¸€ä¸ª<strong>io.ReadWriteCloser</strong>ç±»å‹çš„conné€šé“ã€‚ç„¶ååŸºäºconnæ„å»ºé’ˆå¯¹æœåŠ¡ç«¯çš„jsonç¼–ç è§£ç å™¨ã€‚æœ€åé€šè¿‡<strong>rpc.ServeRequest</strong>å‡½æ•°ä¸ºæ¯æ¬¡è¯·æ±‚å¤„ç†ä¸€æ¬¡RPCæ–¹æ³•è°ƒç”¨ã€‚</p>
<p><em>æ¨¡æ‹Ÿä¸€æ¬¡RPCè°ƒç”¨çš„è¿‡ç¨‹å°±æ˜¯å‘è¯¥é“¾æ¥å‘é€ä¸€ä¸ªjsonå­—ç¬¦ä¸²ï¼š</em></p>
<pre><code class="language-shell">$ curl localhost:1234/jsonrpc -X POST \
    --data '{&quot;method&quot;:&quot;HelloService.Hello&quot;,&quot;params&quot;:[&quot;hello&quot;],&quot;id&quot;:0}'
</code></pre>
<p><em>è¿”å›çš„ç»“æœä¾ç„¶æ˜¯jsonå­—ç¬¦ä¸²ï¼š</em></p>
<pre><code class="language-json">{&quot;id&quot;:0,&quot;result&quot;:&quot;hello:hello&quot;,&quot;error&quot;:null}
</code></pre>
<p>è¿™æ ·å°±å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä»ä¸åŒè¯­è¨€ä¸­è®¿é—®RPCæœåŠ¡äº†ã€‚</p>

        </div>
        
        <div class="my-4">
    
    <a href="https://damon-zhangb.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF/" class="inline-block bg-tertiary-bg text-sm rounded px-3 py-1 my-1 mr-2 hover:text-eureka">#åˆ†å¸ƒå¼æŠ€æœ¯</a>
    
</div>
        
        
        


        
        
        <div class="py-2">
    
    <div class="flex flex-col md:flex-row items-center my-8">
        <a href="https://damon-zhangb.github.io/authors/me/" class="w-24 h-24 md:mr-4">
            
            
            <img src="https://damon-zhangb.github.io/android-chrome-512x512.png" class="w-full bg-primary-bg rounded-full" alt="Avatar">
            
        </a>
        <div class="w-full md:w-auto mt-4 md:mt-0">
            <a href="https://damon-zhangb.github.io/authors/me/" class="block font-bold text-lg pb-1 mb-2 border-b">Zhang Bu</a>
            <span class="block pb-2">Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos.</span>
            
            
            
            
            
            <a href="mailto:example@example.com" class="mr-1">
                <i class="fab fa-fab fa-weixin"></i>
            </a>
            
            
            
            
            
            <a href="https://example.com/" class="mr-1">
                <i class="fab fa-fab fa-qq"></i>
            </a>
            
            
            
            
            
            <a href="https://example.com/" class="mr-1">
                <i class="fab fa-github"></i>
            </a>
            
            
            
            
            
            <a href="https://example.com/" class="mr-1">
                <i class="fab fa-fab fa-zhihu"></i>
            </a>
            
        </div>
    </div>
    
</div>
        
        
        
<div class="flex flex-col md:flex-row md:justify-between -mx-2 mt-4 px-2 pt-4 border-t">
    <div>
        
        <span class="block font-bold">ä¸Šä¸€é¡µ</span>
        <a href="https://damon-zhangb.github.io/posts/protobuf%E5%BA%8F%E5%88%97%E5%8F%B7%E5%8D%8F%E8%AE%AE/" class="block">ProtoBufåºåˆ—åŒ–åè®®</a>
        
    </div>
    <div class="md:text-right mt-4 md:mt-0">
        
        <span class="block font-bold">ä¸‹ä¸€é¡µ</span>
        <a href="https://damon-zhangb.github.io/posts/go-%E6%AF%8F%E6%97%A5%E4%B8%80%E5%BA%93%E4%B9%8B-gin/" class="block">Go æ¯æ—¥ä¸€åº“ä¹‹ Gin</a>
        
    </div>
</div>

        



    </div>
    
    <div class="col-span-2">
        
        
        <div class="sticky top-16 z-10 hidden lg:block px-6 py-4  bg-primary-bg ">
    <span class="text-lg font-semibold">æœ¬é¡µå†…å®¹</span>
</div>
<div class="sticky-toc hidden lg:block px-6 pb-6 ">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#ç®€ä»‹">ç®€ä»‹</a></li>
    <li><a href="#ç†è®º">ç†è®º</a>
      <ul>
        <li>
          <ul>
            <li>
              <ul>
                <li><a href="#ä¸‹é¢åˆ†åˆ«ä»‹ç»æ ¸å¿ƒ-rpc-æ¡†æ¶çš„é‡è¦ç»„æˆ">ä¸‹é¢åˆ†åˆ«ä»‹ç»æ ¸å¿ƒ RPC æ¡†æ¶çš„<strong>é‡è¦ç»„æˆ</strong>ï¼š</a></li>
                <li><a href="#æœåŠ¡çš„è°ƒç”¨è¿‡ç¨‹ä¸º">æœåŠ¡çš„<strong>è°ƒç”¨è¿‡ç¨‹</strong>ä¸ºï¼š</a></li>
                <li><a href="#æ€»ç»“ä¸€ä¸‹rpcè¦è§£å†³çš„ä¸¤ä¸ªé—®é¢˜">æ€»ç»“ä¸€ä¸‹ï¼Œ<strong>RPCè¦è§£å†³çš„ä¸¤ä¸ªé—®é¢˜ï¼š</strong></a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#hello-world">Hello World</a></li>
    <li><a href="#æ›´å®‰å…¨çš„rpcæ¥å£">æ›´å®‰å…¨çš„RPCæ¥å£</a></li>
    <li><a href="#è·¨è¯­è¨€çš„rpc">è·¨è¯­è¨€çš„RPC</a></li>
    <li><a href="#httpä¸Šçš„rpc">Httpä¸Šçš„rpc</a></li>
  </ul>
</nav>
</div>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        enableStickyToc();
    });
</script>
        
    </div>
    

    
    
</div>
<script>
    document.addEventListener('DOMContentLoaded', ()=>{
        hljs.initHighlightingOnLoad();
    })
</script>

      </div>
    </div>
    
  </main>
  <footer class="pl-scrollbar">
    <div class="w-full max-w-screen-xl mx-auto"><div class="text-center p-6 pin-b">
    <p class="text-sm text-tertiary-text">&copy; 2021 <a href="https://github.com/Damon-Zhangb">Damon.Zhang</a>
 &middot;  Powered by the <a href="https://github.com/wangchucheng/hugo-eureka" class="hover:text-eureka">Eureka</a> theme for <a href="https://gohugo.io" class="hover:text-eureka">Hugo</a></p>
</div></div>
  </footer>
</body>

</html>